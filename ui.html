<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* Shadcn ìŠ¤íƒ€ì¼ CSS */
    * {
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #ffffff;
      color: #0f172a;
      font-size: 14px;
      line-height: 1.5;
    }
    
    .container {
      padding: 20px;
      max-width: 100%;
    }
    
    .header {
      margin-bottom: 24px;
    }
    
    .title {
      font-size: 18px;
      font-weight: 600;
      color: #0f172a;
      margin: 0 0 8px 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .subtitle {
      font-size: 14px;
      color: #64748b;
      margin: 0;
    }
    
    .card {
      background: #ffffff;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
    }
    
    .card-header {
      margin-bottom: 16px;
    }
    
    .card-title {
      font-size: 16px;
      font-weight: 600;
      color: #0f172a;
      margin: 0 0 4px 0;
    }
    
    .card-description {
      font-size: 13px;
      color: #64748b;
      margin: 0;
    }
    
         .stats-grid {
       display: grid;
       grid-template-columns: 1fr 1fr;
       gap: 8px;
       margin-bottom: 16px;
     }
    
         .stat-item {
       text-align: center;
       padding: 8px;
       background: #f8fafc;
       border-radius: 6px;
       border: 1px solid #e2e8f0;
     }
    
         .stat-value {
       font-size: 16px;
       font-weight: 700;
       color: #0f172a;
       margin: 0;
     }
    
    .stat-label {
      font-size: 12px;
      color: #64748b;
      margin: 4px 0 0 0;
    }
    
    .tone-chart {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
    }
    
    .tone-bar {
      flex: 1;
      height: 8px;
      background: #e2e8f0;
      border-radius: 4px;
      overflow: hidden;
    }
    
    .tone-fill {
      height: 100%;
      background: #3b82f6;
      transition: width 0.3s ease;
    }
    
    .tone-labels {
      display: flex;
      justify-content: space-between;
      font-size: 11px;
      color: #64748b;
    }
    
    .keywords {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 12px;
    }
    
    .keyword-tag {
      background: #f1f5f9;
      color: #475569;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      border: 1px solid #e2e8f0;
    }
    
    .preview-list {
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
    }
    
    .preview-item {
      padding: 12px;
      border-bottom: 1px solid #f1f5f9;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .preview-item:last-child {
      border-bottom: none;
    }
    
    .preview-checkbox {
      width: 16px;
      height: 16px;
      accent-color: #3b82f6;
    }
    
    .preview-content {
      flex: 1;
    }
    
    .preview-original {
      color: #64748b;
      font-size: 13px;
      margin-bottom: 4px;
      text-decoration: line-through;
    }
    
    .preview-converted {
      color: #0f172a;
      font-size: 13px;
      font-weight: 500;
    }
    
    .preview-no-change {
      color: #94a3b8;
      font-size: 13px;
      font-style: italic;
    }
    
    .button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 8px 16px;
      font-size: 14px;
      font-weight: 500;
      border-radius: 6px;
      border: 1px solid transparent;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
      width: 100%;
      margin-bottom: 8px;
    }
    
    .button-primary {
      background: #3b82f6;
      color: #ffffff;
      border-color: #3b82f6;
    }
    
    .button-primary:hover {
      background: #2563eb;
      border-color: #2563eb;
    }
    
    .button-secondary {
      background: #ffffff;
      color: #64748b;
      border-color: #d1d5db;
    }
    
    .button-secondary:hover {
      background: #f9fafb;
      border-color: #9ca3af;
    }
    
    .button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px;
      color: #64748b;
    }
    
    .spinner {
      width: 16px;
      height: 16px;
      border: 2px solid #e2e8f0;
      border-top: 2px solid #3b82f6;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 8px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .error {
      background: #fef2f2;
      border: 1px solid #fecaca;
      color: #dc2626;
      padding: 12px;
      border-radius: 6px;
      font-size: 13px;
    }
    
    .success {
      background: #f0fdf4;
      border: 1px solid #bbf7d0;
      color: #16a34a;
      padding: 12px;
      border-radius: 6px;
      font-size: 13px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1 class="title">
        ğŸ¯ DOLGO UX Writer
      </h1>
      <p class="subtitle">í•œêµ­ì–´ UX Writing ì¹œê·¼í•œ í†¤ ë³€í™˜ ë° ë¶„ì„</p>
    </div>

    <div id="initial-state">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">í…ìŠ¤íŠ¸ ë¶„ì„</h3>
          <p class="card-description">ì„ íƒí•œ í…ìŠ¤íŠ¸ì˜ í†¤ì„ ë¶„ì„í•˜ê³  ì¹œê·¼í•œ í‘œí˜„ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.</p>
        </div>
        <button id="analyze-btn" class="button button-primary">í…ìŠ¤íŠ¸ ë¶„ì„í•˜ê¸°</button>
      </div>
    </div>

    <div id="analysis-state" style="display: none;">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">í†¤ í”„ë¡œíŒŒì¼</h3>
          <p class="card-description">ë¶„ì„ëœ í…ìŠ¤íŠ¸ì˜ í†¤ íŠ¹ì„±ì„ í™•ì¸í•˜ì„¸ìš”.</p>
        </div>
        
        <div class="stats-grid">
          <div class="stat-item">
            <div class="stat-value" id="total-texts">0</div>
            <div class="stat-label">ì´ í…ìŠ¤íŠ¸</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="avg-length">0</div>
            <div class="stat-label">í‰ê·  ê¸¸ì´</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="total-nodes">0</div>
            <div class="stat-label">í…ìŠ¤íŠ¸ ë…¸ë“œ</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="selected-frames">0</div>
            <div class="stat-label">ì„ íƒëœ Frame</div>
          </div>
        </div>

        <div id="sentence-styles" style="display: none;">
          <h4 style="margin: 0 0 8px 0; font-size: 14px; color: #374151;">ë¬¸ì¥ ìŠ¤íƒ€ì¼</h4>
          <div class="tone-chart">
            <div class="tone-bar">
              <div class="tone-fill" id="command-fill" style="width: 0%"></div>
            </div>
            <div class="tone-bar">
              <div class="tone-fill" id="question-fill" style="width: 0%"></div>
            </div>
            <div class="tone-bar">
              <div class="tone-fill" id="statement-fill" style="width: 0%"></div>
            </div>
          </div>
          <div class="tone-labels">
            <span>ëª…ë ¹ë¬¸</span>
            <span>ì˜ë¬¸ë¬¸</span>
            <span>ì„œìˆ ë¬¸</span>
          </div>
        </div>

        <div id="emotion-tones" style="display: none;">
          <h4 style="margin: 16px 0 8px 0; font-size: 14px; color: #374151;">ê°ì • í†¤</h4>
          <div class="tone-chart">
            <div class="tone-bar">
              <div class="tone-fill" id="friendly-fill" style="width: 0%"></div>
            </div>
            <div class="tone-bar">
              <div class="tone-fill" id="professional-fill" style="width: 0%"></div>
            </div>
            <div class="tone-bar">
              <div class="tone-fill" id="casual-fill" style="width: 0%"></div>
            </div>
          </div>
          <div class="tone-labels">
            <span>ì¹œê·¼</span>
            <span>ì „ë¬¸</span>
            <span>ìºì£¼ì–¼</span>
          </div>
        </div>

        <div id="keywords-section" style="display: none;">
          <h4 style="margin: 16px 0 8px 0; font-size: 14px; color: #374151;">ì£¼ìš” í‚¤ì›Œë“œ</h4>
          <div class="keywords" id="keywords-list"></div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h3 class="card-title">ë³€í™˜ ë¯¸ë¦¬ë³´ê¸°</h3>
          <p class="card-description">ë³€ê²½ë  í…ìŠ¤íŠ¸ë¥¼ í™•ì¸í•˜ê³  ì„ íƒì ìœ¼ë¡œ ì ìš©í•˜ì„¸ìš”.</p>
        </div>
        
        <div class="preview-list" id="preview-list"></div>
        
        <div style="margin-top: 16px;">
          <button id="apply-selected-btn" class="button button-primary">ì„ íƒ í•­ëª© ì ìš©í•˜ê¸°</button>
          <button id="apply-all-btn" class="button button-secondary">ëª¨ë“  í•­ëª© ì ìš©í•˜ê¸°</button>
        </div>
      </div>
    </div>

    <div id="loading-state" style="display: none;">
      <div class="loading">
        <div class="spinner"></div>
        í…ìŠ¤íŠ¸ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...
      </div>
    </div>

    <div id="error-state" style="display: none;">
      <div class="error" id="error-message"></div>
      <button id="reselect-btn" class="button button-primary" style="margin-top: 12px;">ë‹¤ì‹œ ì„ íƒí•˜ê¸°</button>
    </div>

    <div style="margin-top: 16px;">
      <button id="cancel-btn" class="button button-secondary">ì·¨ì†Œ</button>
    </div>
  </div>

  <script>
    let analysisData = null;
    let selectedItems = [];

    // UI ìƒíƒœ ê´€ë¦¬
    function showState(state) {
      ['initial-state', 'analysis-state', 'loading-state', 'error-state'].forEach(s => {
        document.getElementById(s).style.display = 'none';
      });
      document.getElementById(state).style.display = 'block';
    }

    // ë¶„ì„ ê²°ê³¼ í‘œì‹œ
    function displayAnalysis(data) {
      if (data.error) {
        document.getElementById('error-message').textContent = data.error;
        showState('error-state');
        return;
      }

      analysisData = data;
      
             // ê¸°ë³¸ í†µê³„
       document.getElementById('total-texts').textContent = data.profile.totalTexts;
       document.getElementById('avg-length').textContent = data.profile.averageLength;
       document.getElementById('total-nodes').textContent = data.totalNodes || 0;
       document.getElementById('selected-frames').textContent = data.selectedFrames || 0;

      // ë¬¸ì¥ ìŠ¤íƒ€ì¼ ì°¨íŠ¸
      const totalStyles = Object.values(data.profile.sentenceStyles).reduce((a, b) => a + b, 0);
      if (totalStyles > 0) {
        document.getElementById('sentence-styles').style.display = 'block';
        document.getElementById('command-fill').style.width = `${(data.profile.sentenceStyles.ëª…ë ¹ë¬¸ / totalStyles) * 100}%`;
        document.getElementById('question-fill').style.width = `${(data.profile.sentenceStyles.ì˜ë¬¸ë¬¸ / totalStyles) * 100}%`;
        document.getElementById('statement-fill').style.width = `${(data.profile.sentenceStyles.ì„œìˆ ë¬¸ / totalStyles) * 100}%`;
      }

      // ê°ì • í†¤ ì°¨íŠ¸
      const totalTones = Object.values(data.profile.emotionTones).reduce((a, b) => a + b, 0);
      if (totalTones > 0) {
        document.getElementById('emotion-tones').style.display = 'block';
        document.getElementById('friendly-fill').style.width = `${(data.profile.emotionTones.friendly / totalTones) * 100}%`;
        document.getElementById('professional-fill').style.width = `${(data.profile.emotionTones.professional / totalTones) * 100}%`;
        document.getElementById('casual-fill').style.width = `${(data.profile.emotionTones.casual / totalTones) * 100}%`;
      }

      // í‚¤ì›Œë“œ í‘œì‹œ
      const keywords = Object.entries(data.profile.keywords)
        .sort(([,a], [,b]) => b - a)
        .slice(0, 10);
      
      if (keywords.length > 0) {
        document.getElementById('keywords-section').style.display = 'block';
        const keywordsList = document.getElementById('keywords-list');
        keywordsList.innerHTML = keywords.map(([keyword, count]) => 
          `<span class="keyword-tag">${keyword} (${count})</span>`
        ).join('');
      }

      // ë¯¸ë¦¬ë³´ê¸° ëª©ë¡
      displayPreviews(data.previews);
      
      showState('analysis-state');
    }

    // ë¯¸ë¦¬ë³´ê¸° ëª©ë¡ í‘œì‹œ
    function displayPreviews(previews) {
      const previewList = document.getElementById('preview-list');
      previewList.innerHTML = '';

      previews.forEach((preview, index) => {
        const item = document.createElement('div');
        item.className = 'preview-item';
        
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.className = 'preview-checkbox';
        checkbox.checked = preview.hasChanges;
        checkbox.onchange = () => {
          if (checkbox.checked) {
            selectedItems.push(preview);
          } else {
            selectedItems = selectedItems.filter(item => item.nodeId !== preview.nodeId);
          }
        };

        const content = document.createElement('div');
        content.className = 'preview-content';

                 if (preview.hasChanges) {
           content.innerHTML = `
             <div class="preview-original">${preview.original}</div>
             <div class="preview-converted">${preview.converted}</div>
             <div style="font-size: 11px; color: #94a3b8; margin-top: 2px;">${preview.nodeName}</div>
           `;
         } else {
           content.innerHTML = `
             <div class="preview-no-change">${preview.original} (ë³€ê²½ ì—†ìŒ)</div>
             <div style="font-size: 11px; color: #94a3b8; margin-top: 2px;">${preview.nodeName}</div>
           `;
         }

        item.appendChild(checkbox);
        item.appendChild(content);
        previewList.appendChild(item);

        if (preview.hasChanges) {
          selectedItems.push(preview);
        }
      });
    }

    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    document.getElementById('analyze-btn').onclick = () => {
      showState('loading-state');
      parent.postMessage({ pluginMessage: { type: 'analyze-text' } }, '*');
    };

    document.getElementById('apply-selected-btn').onclick = () => {
      if (selectedItems.length > 0) {
        parent.postMessage({ 
          pluginMessage: { 
            type: 'apply-selected', 
            data: { selectedItems } 
          } 
        }, '*');
      }
    };

    document.getElementById('apply-all-btn').onclick = () => {
      parent.postMessage({ pluginMessage: { type: 'convert-text' } }, '*');
    };

         document.getElementById('cancel-btn').onclick = () => {
       parent.postMessage({ pluginMessage: { type: 'cancel' } }, '*');
     };

     document.getElementById('reselect-btn').onclick = () => {
       showState('initial-state');
     };

    // ë©”ì‹œì§€ ìˆ˜ì‹ 
    window.onmessage = (event) => {
      const message = event.data.pluginMessage;
      
      if (message.type === 'analysis-result') {
        displayAnalysis(message.data);
      }
    };
</script>
</body>
</html>
